#!/usr/bin/env python3

import argparse
import json

import conllu

from cxnminer.utils.helpers import open_file


level_dict = {
    'np_function': 'deprel'
}


if __name__ == "__main__":

    parser = argparse.ArgumentParser(description='Encode parts of a wikipedia dump')
    parser.add_argument('infile')
    parser.add_argument('outfile')
    parser.add_argument('dictionary')
    parser.add_argument('levels', type=str, nargs='+')
    args = parser.parse_args()

    with open_file(args.dictionary) as dict_file:
        vocabulary = json.load(dict_file)

    with open_file(args.outfile, 'w') as outfile:
        for sentence in conllu.parse_incr(open_file(args.infile)):

            for token in sentence:

                for level in args.levels:

                    ## get name of level, if it is an alias
                    level_name = level_dict.get(level, level)
                    ## write encoded data into token
                    token[level_name] = vocabulary.get(level).get(token[level_name], token[level_name])

            print(sentence.serialize(), file=outfile)
